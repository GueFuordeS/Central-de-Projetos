package pessoa;

import java.util.HashSet;

import excecoes.*;

public class PessoaController {
	private HashSet<Pessoa> pessoas;
	
	public PessoaController() {
		this.pessoas = new HashSet<>();
	}

	public String cadastraPessoa(String cpf, String nome, String email) throws ValidacaoException {
			Pessoa novaPessoa = new Pessoa(cpf,nome,email);
			for(Pessoa p:pessoas) {
				if(p.getCpf().equals(cpf)) {
					throw new ValidacaoException("Erro no cadastro de pessoa: Pessoa com mesmo CPF ja cadastrada");
				}
			}
			this.pessoas.add(novaPessoa);
			return novaPessoa.getCpf();
	}
	
	public void removePessoa(String cpf) throws ValidacaoException, NaoEncontradaException {
		Pessoa p = this.recuperaPessoa(cpf);
		pessoas.remove(p);
	}
	
	public Pessoa recuperaPessoa(String cpf) throws NaoEncontradaException, ValidacaoException {
		Validacao.validaCpfGeneric(cpf);
		for(Pessoa p:pessoas) {
			if(p.getCpf().equals(cpf)) {
				return p;
			}
		}
		throw new NaoEncontradaException();
	}
	
	public void editaPessoa(String cpf, String opcao, String nova) throws ValidacaoException, NaoEncontradaException {
		Pessoa p = this.recuperaPessoa(cpf);
		
		if(opcao.toLowerCase().equals("nome")) {
			p.setNome(nova);
		}
		else if(opcao.toLowerCase().equals("email")) {
			Validacao.validaEmailUpdate(nova);
			p.setEmail(nova);
		}
		
		else if(opcao.toLowerCase().equals("cpf")) { 
			throw new ValidacaoException("Erro na atualizacao de pessoa: CPF nao pode ser alterado");
	}
		
		else throw new ValidacaoException("Opcao especificada nao existe");
	}
	
	public String getInfoPessoa(String cpf, String atributo) throws NaoEncontradaException, ValidacaoException {
		Pessoa p = this.recuperaPessoa(cpf);
		
		if(atributo.toLowerCase().equals("cpf")) {
			return p.getCpf();
		}
		else if(atributo.toLowerCase().equals("nome")) {
			return p.getNome();
		}
		else if(atributo.toLowerCase().equals("email")) {
			return p.getEmail();
		}
		return null;
		
	}
	
	public String toString() {
		String retorno = "";
		for(Pessoa p:pessoas) {
			retorno += p;
		}
		return retorno;
	}
}
